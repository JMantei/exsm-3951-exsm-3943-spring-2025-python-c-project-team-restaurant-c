@model RestaurantManager.Models.User

@{
    ViewData["Title"] = "Customer Dashboard";
}

<div class="container py-5">
    <h2 class="mb-4 fw-semibold">Welcome, @Model.FirstName @Model.LastName!</h2>

    <div class="row g-4">

        <!-- Loyalty Rewards -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="card-title">Loyalty Rewards</h5>
                    <p class="card-text">You have <strong>@Model.RewardsPoints</strong> points.</p>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="rewardsToggle">
                        <label class="form-check-label" for="rewardsToggle">Enable Rewards</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reservation Info -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="card-title">Reservation Info</h5>
                    @if (Model.Reservations != null && Model.Reservations.Any())
                    {
                        var res = Model.Reservations.First();
                        <p class="card-text mb-3">Reservation #: <strong>@res.Id</strong></p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary rounded-pill">Review Order</button>
                            <button class="btn btn-outline-secondary rounded-pill">Edit Reservation</button>
                            <button class="btn btn-outline-danger rounded-pill">Cancel Reservation</button>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">No current reservations.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Personal Info with Edit Toggle -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="card-title d-flex justify-content-between align-items-center mb-4">
                        Personal Information
                        <button class="btn btn-sm btn-outline-primary" id="editToggleBtn" type="button"
                            onclick="toggleEdit()">Edit</button>
                    </h5>

                    <!-- Display Mode -->
                    <div id="infoDisplay">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">First Name</label>
                                <div class="form-control-plaintext">@Model.FirstName</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Last Name</label>
                                <div class="form-control-plaintext">@Model.LastName</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Email</label>
                            <div class="form-control-plaintext">@Model.Email</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Phone</label>
                            <div class="form-control-plaintext">@Model.Phone</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Dietary Notes</label>
                            <div class="form-control-plaintext">@Model.DietaryNotes</div>
                        </div>
                    </div>

                    <!-- Edit Mode -->
                    <form method="post" action="/User/UpdateProfile" id="infoEdit" class="d-none">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="FirstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="FirstName" name="FirstName"
                                    value="@Model.FirstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="LastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="LastName" name="LastName"
                                    value="@Model.LastName" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="Email" name="Email" value="@Model.Email"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="Phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="Phone" name="Phone" value="@Model.Phone"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="Password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="Password" name="Password"
                                placeholder="Enter new password">
                        </div>

                        <div class="mb-3">
                            <label for="DietaryNotes" class="form-label">Dietary Notes</label>
                            <textarea class="form-control" id="DietaryNotes" name="DietaryNotes"
                                rows="2">@Model.DietaryNotes</textarea>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="toggleEdit()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        @section Scripts {
            <script>
                function toggleEdit() {
                    const display = document.getElementById("infoDisplay");
                    const edit = document.getElementById("infoEdit");
                    const button = document.getElementById("editToggleBtn");

                    const isEditing = !edit.classList.contains("d-none");

                    if (isEditing) {
                        edit.classList.add("d-none");
                        display.classList.remove("d-none");
                        button.textContent = "Edit";
                    } else {
                        edit.classList.remove("d-none");
                        display.classList.add("d-none");
                        button.textContent = "Cancel";
                    }
                }
            </script>
        }



        <!-- Delivery Addresses -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="card-title">Delivery Addresses</h5>

                    @if (Model.UserAddresses != null && Model.UserAddresses.Any())
                    {
                        <ul class="list-group list-group-flush mb-3">
                            @foreach (var addr in Model.UserAddresses)
                            {
                                <li class="list-group-item">
                                    @addr.AddressLine1, @addr.City, @addr.Province @addr.PostalCode, @addr.Country
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted">No addresses on file.</p>
                    }

                    <form method="post" action="/User/AddAddress">
                        <div class="mb-3">
                            <label for="AddressLine1" class="form-label">Address line 1</label>
                            <input type="text" class="form-control" id="AddressLine1" name="AddressLine1"
                                placeholder="123 Main St" required>
                        </div>

                        <div class="mb-3">
                            <label for="AddressLine2" class="form-label">Address line 2 (optional)</label>
                            <input type="text" class="form-control" id="AddressLine2" name="AddressLine2"
                                placeholder="123 Main St" required>
                        </div>

                        <div class="mb-3">
                            <label for="PostalCode" class="form-label">Postal Code</label>
                            <input type="text" class="form-control" id="PostalCode" name="PostalCode"
                                placeholder="A1A 1A1" required>
                        </div>

                        <div class="mb-3">
                            <label for="City" class="form-label">City</label>
                            <input type="text" class="form-control" id="City" name="City" required readonly>
                        </div>

                        <div class="mb-3">
                            <label for="Province" class="form-label">Province</label>
                            <input type="text" class="form-control" id="Province" name="Province" required readonly>
                        </div>


                        <div class="mb-3">
                            <label for="Country" class="form-label">Country</label>
                            <select class="form-select" id="Country" name="Country" required>
                                <option selected disabled>Select Country</option>
                                <option value="CA">Canada</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 rounded-pill">Add Address</button>
                    </form>
                </div>
            </div>
        </div>


    </div>
</div>
